---
title: Asp-Net-Coreå­¦ä¹ ç¬”è®°ï¼šï¼ˆå››ï¼‰Blazor-WebAssemblyå…¥é—¨
date: 2020/03/28 16:24:13
abbrlink: e1c120ffe7ad1b3c
categories:
- C#
tags:
- WebæŠ€æœ¯
- å…¥é—¨
- ç¬”è®°
- å­¦ä¹ 
---
æœ¬æ¥ä»Šå¤©å¼€å§‹æ˜¯æœ‰å…¶ä»–çš„å®‰æ’äº†ï¼Œä¹Ÿæ²¡åŠæ³•æŠ½å‡ºé‚£ä¹ˆå¤šæ—¶é—´æ¥å­¦NetCoreï¼Œä¸è¿‡æˆ‘æƒ³åšäº‹æƒ…æœ‰å§‹æœ‰ç»ˆå§ï¼Œé™¤äº†gRPCè¿˜æ²¡è·‘èµ·æ¥ä¹‹å¤–ï¼ŒBlazorè¿™éƒ¨åˆ†ä¹Ÿäº†è§£äº†ä¸€ç‚¹ï¼Œå®˜ç½‘åœ°å€ï¼š[https://dotnet.microsoft.com/apps/aspnet/web-apps/blazor](https://dotnet.microsoft.com/apps/aspnet/web-apps/blazor)

ç›®å‰æ¥è¯´è¿˜ä¸æ˜¯å¾ˆå®Œå–„ï¼ŒçœŸæ­£çš„ç¦»çº¿å•é¡µåº”ç”¨è¿˜å¤„äºé¢„è§ˆç‰ˆé˜¶æ®µã€‚

{% asset_img 8869373-75497a8c92c235e5.png %}

Blazorç›®å‰æœ‰ä¸¤ç§è¿è¡Œæ¨¡å¼ï¼Œä¸€ç§æ˜¯æœåŠ¡å™¨ç«¯éƒ¨ç½²ï¼Œä¸€ç§æ˜¯å®¢æˆ·ç«¯éƒ¨ç½²ï¼Œåè€…å¯ä»¥å®Œå…¨è„±ç¦»æœåŠ¡å™¨ï¼Œä¹Ÿå°±æ˜¯æ ‡é¢˜å†™çš„WebAssemblyï¼Œä¸è¿‡ç›®å‰å¤„äºé¢„è§ˆç‰ˆï¼ˆæœ‰ç‚¹æ ‡é¢˜å…šäº†ï¼‰ã€‚

å®˜æ–¹æ–‡æ¡£ï¼š[https://docs.microsoft.com/zh-cn/aspnet/core/blazor/get-started?view=aspnetcore-3.1&tabs=visual-studio](https://docs.microsoft.com/zh-cn/aspnet/core/blazor/get-started?view=aspnetcore-3.1&tabs=visual-studio)

## é¡¹ç›®æ–‡ä»¶ç»“æ„
{% asset_img 8869373-f5c38afcc43b0f16.png %}

ä¸»è¦çš„æ–‡ä»¶å¤¹å°±æ˜¯è¿™ä¸ªPageså’ŒSharedã€‚é‡Œé¢åŒ…å«äº†mvcé¡µé¢(cshtmlç»“å°¾)å’Œrazorç»„ä»¶(razorç»“å°¾)ã€‚

ç„¶åå†çœ‹çœ‹wwwrootæ–‡ä»¶å¤¹ï¼š
{% asset_img 8869373-512cc757a7f22b04.png %}

å¯ä»¥çœ‹åˆ°åªæœ‰cssï¼Œæ²¡æœ‰jsæ–‡ä»¶å¤¹ï¼Œå› ä¸ºblazorè¦åšçš„äº‹æƒ…å°±æ˜¯è¦æŠŠjsä»£ç æ¢æˆC#ä»£ç ï¼Œå…¶å®å°±æ˜¯è®©åç«¯å¼€å‘å»åšå‰ç«¯å¼€å‘ã€‚
ï¼ˆPSï¼šnodeå°±æ˜¯è®©å‰ç«¯å»åšåç«¯ï¼Œå†å²æ€»æ˜¯æƒŠäººçš„ç›¸ä¼¼hhhï¼‰

å…ˆçœ‹çœ‹å®ƒçš„ä»£ç æ˜¯æ€ä¹ˆå†™çš„ï¼Œåé¢å†å…·ä½“ä»‹ç»ã€‚

## ä¾‹å­ä»£ç 
è¿™æ˜¯å®˜æ–¹çš„ä¾‹å­ï¼Œç‚¹å‡»æŒ‰é’®ä¹‹åå¯ä»¥è®¡ç®—ç‚¹å‡»æ¬¡æ•°ã€‚

{% asset_img 8869373-e74eebb309c83588.png %}

```cs
@page "/counter"
<h1>Counter</h1>
<p>Current count: @_currentCount</p>
<button class="btn btn-primary" @onclick="IncrementCount">Click me</button>
@code {
    private int _currentCount = 0;
    private void IncrementCount()
    {
        _currentCount++;
    }
}
```

æˆ‘æ„Ÿè§‰é¡¹ç›®çš„å…·ä½“ä»£ç åº”è¯¥æ”¾åœ¨æœ€åé¢ï¼Œè¿˜æ˜¯ç»§ç»­ä»‹ç»ä¸€ä¸‹åŸç†ä»€ä¹ˆçš„å§~

## æ‰˜ç®¡æ¨¡å‹
å°±æ˜¯å‰æ–‡æåˆ°çš„æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä¸¤ç§æ¨¡å¼ã€‚

### å®¢æˆ·ç«¯æ¨¡å‹
>Blazor çš„ä¸»ä½“å®¿ä¸»æ¨¡å‹åœ¨ WebAssembly ä¸Šçš„æµè§ˆå™¨ä¸­è¿è¡Œå®¢æˆ·ç«¯ã€‚ å°† Blazor åº”ç”¨ã€å…¶ä¾èµ–é¡¹ä»¥åŠ .NET è¿è¡Œæ—¶ä¸‹è½½åˆ°æµè§ˆå™¨ã€‚ åº”ç”¨å°†åœ¨æµè§ˆå™¨çº¿ç¨‹ä¸­ç›´æ¥æ‰§è¡Œã€‚ UI æ›´æ–°å’Œäº‹ä»¶å¤„ç†å‘ç”Ÿåœ¨åŒä¸€è¿›ç¨‹ä¸­ã€‚ åº”ç”¨çš„èµ„äº§å°†ä½œä¸ºé™æ€æ–‡ä»¶éƒ¨ç½²åˆ° web æœåŠ¡å™¨æˆ–å¯ä¸ºå®¢æˆ·ç«¯æä¾›é™æ€å†…å®¹çš„æœåŠ¡ã€‚

{% asset_img 8869373-8a764dee39a84138.png %}

### æœåŠ¡ç«¯æ¨¡å‹
>ä½¿ç”¨ Blazor æœåŠ¡å™¨æ‰˜ç®¡æ¨¡å‹ï¼Œå¯åœ¨æœåŠ¡å™¨ä¸Šä» ASP.NET Core åº”ç”¨ä¸­æ‰§è¡Œåº”ç”¨ã€‚Â UI æ›´æ–°ã€äº‹ä»¶å¤„ç†å’Œ JavaScript è°ƒç”¨æ˜¯é€šè¿‡Â [SignalR](https://docs.microsoft.com/zh-cn/aspnet/core/signalr/introduction?view=aspnetcore-3.1)Â è¿æ¥è¿›è¡Œå¤„ç†ã€‚

{% asset_img 8869373-c2826d7f6ad25ae7.png %}

åˆå‡ºç°SignalRäº†ï¼ŒçœŸçš„å¥½ç”¨ï¼Œå…³äºSignalRçš„å¯ä»¥çœ‹çœ‹æˆ‘ä¸Šä¸€ç¯‡ï¼š[Asp.Net Coreå­¦ä¹ ç¬”è®°ï¼šï¼ˆä¸‰ï¼‰ä½¿ç”¨SignalRå®æ—¶é€šä¿¡æ¡†æ¶å¼€å‘èŠå¤©å®¤](https://zhuanlan.zhihu.com/p/106321863)

Blazor Server å®¿ä¸»æ¨¡å‹å…·æœ‰ä»¥ä¸‹å‡ ä¸ªä¼˜ç‚¹ï¼š
- ä¸‹è½½å¤§å°æ˜æ˜¾å°äº Blazor WebAssembly åº”ç”¨ï¼Œä¸”åº”ç”¨åŠ è½½é€Ÿåº¦å¿«å¾—å¤šã€‚
- åº”ç”¨å……åˆ†åˆ©ç”¨æœåŠ¡å™¨åŠŸèƒ½ï¼ŒåŒ…æ‹¬ä½¿ç”¨ä»»ä½•ä¸ .NET Core å…¼å®¹çš„ Apiã€‚
- æœåŠ¡å™¨ä¸Šçš„ .NET Core ç”¨äºè¿è¡Œåº”ç”¨ç¨‹åºï¼Œå› æ­¤ç°æœ‰çš„ .NET å·¥å…·ï¼ˆå¦‚è°ƒè¯•ï¼‰å¯æŒ‰é¢„æœŸæ–¹å¼å·¥ä½œã€‚
- æ”¯æŒç˜¦å®¢æˆ·ç«¯ã€‚ ä¾‹å¦‚ï¼ŒBlazor Server apps é€‚ç”¨äºä¸æ”¯æŒ WebAssembly çš„æµè§ˆå™¨ä»¥åŠèµ„æºå—é™è®¾å¤‡ä¸Šçš„æµè§ˆå™¨ã€‚
- åº”ç”¨ç¨‹åºçš„ .NET/C#ä»£ç åº“ï¼ˆåŒ…æ‹¬åº”ç”¨ç¨‹åºçš„ç»„ä»¶ä»£ç ï¼‰ä¸ä¼šæä¾›ç»™å®¢æˆ·ç«¯ã€‚

Blazor Server å®¿ä¸»æœ‰ä¸€äº›ç¼ºç‚¹ï¼š
- é€šå¸¸å­˜åœ¨è¾ƒé«˜çš„å»¶è¿Ÿã€‚ æ¯ä¸ªç”¨æˆ·äº¤äº’éƒ½æ¶‰åŠç½‘ç»œè·ƒç‚¹ã€‚
- æ— è„±æœºæ”¯æŒã€‚ å¦‚æœå®¢æˆ·ç«¯è¿æ¥å¤±è´¥ï¼Œåº”ç”¨å°†åœæ­¢å·¥ä½œã€‚
- å¯¹äºåŒ…å«å¤šä¸ªç”¨æˆ·çš„åº”ç”¨è€Œè¨€ï¼Œå¯ä¼¸ç¼©æ€§éå¸¸å›°éš¾ã€‚ æœåŠ¡å™¨å¿…é¡»ç®¡ç†å¤šä¸ªå®¢æˆ·ç«¯è¿æ¥å¹¶å¤„ç†å®¢æˆ·ç«¯çŠ¶æ€ã€‚
- ä¸ºåº”ç”¨æä¾›æœåŠ¡éœ€è¦ ASP.NET Core æœåŠ¡å™¨ã€‚ ä¸å¯èƒ½çš„æ— æœåŠ¡å™¨éƒ¨ç½²æ–¹æ¡ˆï¼ˆä¾‹å¦‚ï¼Œé€šè¿‡ CDN ä¸ºåº”ç”¨æä¾›æœåŠ¡ï¼‰ã€‚

## é¡¹ç›®é…ç½®
é¦–å…ˆæ˜¯ä»ä¸€ä¸ªæ™®é€šçš„AspNetCoreé¡¹ç›®å¼€å§‹ï¼Œè¿›è¡Œä»¥ä¸‹é…ç½®ï¼š
```c#
// æ³¨å†ŒæœåŠ¡
public void ConfigureServices(IServiceCollection services)
{
    services.AddRazorPages();
    services.AddServerSideBlazor();
    services.AddSingleton<WeatherForecastService>();
}

// é…ç½®ä¸­é—´ä»¶
public void Configure(IApplicationBuilder app, IWebHostEnvironment env)
{
    if (env.IsDevelopment())
    {
        app.UseDeveloperExceptionPage();
    }
    else
    {
        // é…ç½®ç”Ÿäº§ç¯å¢ƒçš„é”™è¯¯é¡µé¢
        app.UseExceptionHandler("/Error");
        app.UseHsts();
    }

    app.UseStaticFiles();
    app.UseRouting();

    app.UseEndpoints(endpoints =>
    {
        // ç›¸å½“äºä¸€ä¸ªBlazorç‰ˆçš„SignalR
        endpoints.MapBlazorHub();
        endpoints.MapFallbackToPage("/_Host");
    });
}
```

## ç¼–å†™Razorç»„ä»¶
Blazorä»åå­—çœ‹å°±å’ŒAspNetCoreåŸæœ‰çš„Razorç›¸ä¼¼ï¼Œæ‰€ä»¥ä»–ä»¬ä¿©çš„å¾ˆå¤šè¯­æ³•æ˜¯æ¥è¿‘çš„ï¼Œæ¯”å¦‚è¯´TagHelperã€‚

å…ˆå†™`App.razor`ï¼š
```xml
<Router AppAssembly="@typeof(Program).Assembly">
    <Found Context="routeData">
        <RouteView RouteData="@routeData" DefaultLayout="@typeof(MainLayout)" />
    </Found>
    <NotFound>
        <LayoutView Layout="@typeof(MainLayout)">
            <p>Sorry, there's nothing at this address.</p>
        </LayoutView>
    </NotFound>
</Router>
```

ä¹‹å‰åœ¨ä¸­é—´ä»¶é‚£é‡Œé…ç½®äº†`endpoints.MapFallbackToPage("/_Host");`ï¼Œå¯ä»¥ç†è§£ä¸ºé»˜è®¤é¡µé¢å§ã€‚

å†…å®¹å¦‚ä¸‹ï¼š

```c#
@page "/"
@namespace BlazorOne.Pages
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
@{
    Layout = null;
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>BlazorOne</title>
    <base href="~/" />
    <link rel="stylesheet" href="css/bootstrap/bootstrap.min.css" />
    <link href="css/site.css" rel="stylesheet" />
</head>
<body>
    <app>
        <component type="typeof(App)" render-mode="ServerPrerendered" />
    </app>

    <div id="blazor-error-ui">
        <environment include="Staging,Production">
            An error has occurred. This application may no longer respond until reloaded.
        </environment>
        <environment include="Development">
            An unhandled exception has occurred. See browser dev tools for details.
        </environment>
        <a href="" class="reload">Reload</a>
        <a class="dismiss">ğŸ—™</a>
    </div>

    <script src="_framework/blazor.server.js"></script>
</body>
</html>
```

å¯ä»¥çœ‹åˆ°å°±æ˜¯ä¸€ä¸ªæ™®é€šçš„AspNetCoreçš„MVCé¡µé¢çš„å†™æ³•ï¼Œä¸è¿‡bodyé‡Œé¢æœ‰appèŠ‚ç‚¹ï¼Œå¯ä»¥æ¸²æŸ“å…¶ä»–Razorç»„ä»¶ã€‚

## æ•ˆæœ
è¿™æ˜¯å®˜æ–¹ä¾‹å­è·‘èµ·æ¥çš„æ•ˆæœï¼Œæˆ‘ä¹Ÿæ²¡æƒ³å‡ºæ¥æ‹¿è¿™ä¸ªåšä»€ä¹ˆå¥½ï¼Œæ‰€ä»¥å°±å•çº¯è·‘ä¸€ä¸‹å®˜æ–¹ä¾‹å­å¥½äº†ï¼ˆæ‡’ï¼‰

{% asset_img 8869373-3d1ca6114d70ebd0.png %}

{% asset_img 8869373-0e4630f06854015e.png %}

{% asset_img 8869373-118343bec8559b63.png %}

æˆ‘å‘ç°å¾®è½¯çš„å®˜æ–¹æ–‡æ¡£è¿˜æ˜¯ä¸é”™çš„ï¼Œè™½ç„¶å¥½åƒæœ‰ç‚¹åƒæ˜¯æœºç¿»çš„ï¼Œä½†æ˜¯çœ‹èµ·æ¥è¿˜æŒºé€šé¡ºï¼Œä¹Ÿå¾ˆè¯¦ç»†ã€‚

å®˜æ–¹æ–‡æ¡£ï¼š[https://docs.microsoft.com/zh-cn/aspnet/core/blazor/hosting-models?view=aspnetcore-3.1](https://docs.microsoft.com/zh-cn/aspnet/core/blazor/hosting-models?view=aspnetcore-3.1)

## æ¬¢è¿äº¤æµ
äº¤æµé—®é¢˜è¯·åœ¨å¾®ä¿¡å…¬ä¼—å·åå°ç•™è¨€ï¼Œæ¯ä¸€æ¡ä¿¡æ¯æˆ‘éƒ½ä¼šå›å¤å“ˆ~
- å¾®ä¿¡å…¬ä¼—å·ï¼šç”»æ˜Ÿæ˜Ÿé«˜æ‰‹
- æ‰“ä»£ç ç›´æ’­é—´ï¼š[https://live.bilibili.com/11883038](https://live.bilibili.com/11883038)
- çŸ¥ä¹ï¼š[https://www.zhihu.com/people/dealiaxy](https://www.zhihu.com/people/dealiaxy)
- ä¸“æ ï¼š[https://zhuanlan.zhihu.com/deali](https://zhuanlan.zhihu.com/deali)
- ç®€ä¹¦ï¼š[https://www.jianshu.com/u/965b95853b9f](https://www.jianshu.com/u/965b95853b9f)
